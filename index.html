<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì¹´ë“œ ë’¤ì§‘ê¸° ê²Œì„ - ìµìŠ¤íŠ¸ë¦¼ í¬í•¨ (ìˆ˜ì •ë¨)</title>
<style>
  body { font-family: sans-serif; text-align:center; padding:20px; }
  .wrap { display:flex; align-items:flex-start; gap:20px; justify-content:center; }
  #scoreboard { width:160px; text-align:left; }
  #game { display:grid; gap:8px; justify-content:center; margin-top:10px; }
  .card { width:60px; height:60px; background:#4e6ef2; color:transparent; display:flex; align-items:center; justify-content:center; font-size:32px; cursor:pointer; border-radius:8px; user-select:none; transition: transform .25s, background .2s, color .2s; }
  .card.flipped { background:#ffffff; color:#000000; transform: scale(1.02); }
  .controls { margin-bottom:10px; }
  button { margin-left:6px; padding:6px 10px; }
</style>
</head>
<body>
  <div class="controls">
    <span id="timer" style="margin-right:15px; font-weight:bold;">ì‹œê°„: 0ì´ˆ</span>
    <label>ë‚œì´ë„: </label>
    <select id="difficulty">
      <option value="easy">í•˜ (8ì¥)</option>
      <option value="medium">ì¤‘ (12ì¥)</option>
      <option value="hard">ìƒ (16ì¥)</option>
      <option value="extreme">ìµìŠ¤íŠ¸ë¦¼ (64ì¥)</option>
    </select>
    <button id="startBtn">ê²Œì„ ì‹œì‘</button>
    <button id="giveupBtn">ì¤‘ë„ í¬ê¸°</button>
  </div>

  <div class="wrap">
    <div id="scoreboard"><b>ê¸°ë¡</b><br>ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>
    <div id="game"></div>
  </div>

  <div id="message" style="margin-top:15px; font-size:20px; font-weight:bold;"></div>
  <button id="restartBtn" style="display:none; margin-top:10px; padding:8px 16px;">ë‹¤ì‹œ í•˜ê¸°</button>

<script>
// ì•ˆì „ì„ ìœ„í•´ DOMContentLoaded ì•ˆì—ì„œ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
window.addEventListener('DOMContentLoaded', () => {
  const emojiSets = [
    "ğŸ¶","ğŸ±","ğŸ°","ğŸ¹","ğŸ¸","ğŸ¼","ğŸµ","ğŸ¦Š",
    "ğŸ¤","ğŸ™","ğŸ","ğŸ¢","ğŸ¦","ğŸ¯","ğŸ¨","ğŸ§",
    "ğŸ´","ğŸ—","ğŸº","ğŸ¦„","ğŸ","ğŸª¼","ğŸ¦‘","ğŸ¦‚",
    "ğŸ¬","ğŸ³","ğŸ¦ˆ","ğŸ¦­","ğŸŠ","ğŸ¦•","ğŸ¦–","ğŸ¦¦"
  ]; // 32ì¢… -> ìµìŠ¤íŠ¸ë¦¼(64ì¥)ìš©

  const gameBoard = document.getElementById("game");
  const startBtn = document.getElementById("startBtn");
  const giveupBtn = document.getElementById("giveupBtn");
  const restartBtn = document.getElementById("restartBtn");
  const difficultySelect = document.getElementById("difficulty");
  const timerLabel = document.getElementById("timer");
  const messageEl = document.getElementById("message");
  const scoreboardEl = document.getElementById("scoreboard");

  // ë°©ì–´ ì½”ë“œ: ì¤‘ìš”í•œ ìš”ì†Œê°€ ì—†ìœ¼ë©´ ì—ëŸ¬ë¥¼ í”¼í•˜ê³  ë©”ì‹œì§€ë¥¼ í‘œì‹œ
  if (!gameBoard || !startBtn || !giveupBtn || !restartBtn || !difficultySelect || !timerLabel || !messageEl || !scoreboardEl) {
    console.error('í•„ìˆ˜ DOM ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    return;
  }

  let firstCard = null;
  let matchedCount = 0;
  let timer = 0;
  let timerInterval = null; // ë°˜ë“œì‹œ ì„ ì–¸ë˜ì–´ ìˆì–´ì•¼ í•¨
  let lock = false;
  let records = []; // ì´ˆ ë‹¨ìœ„ ê¸°ë¡ (ì˜¤ë¦„ì°¨ìˆœ ì €ì¥)

  // ì´ˆê¸° í™”ë©´
  timerLabel.innerText = `ì‹œê°„: ${timer}ì´ˆ`;
  updateScoreboardDisplay();

  startBtn.addEventListener('click', startGame);
  giveupBtn.addEventListener('click', giveUp);
  restartBtn.addEventListener('click', startGame);

  function startGame(){
    // ì´ˆê¸°í™”
    if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
    timer = 0;
    timerLabel.innerText = `ì‹œê°„: ${timer}ì´ˆ`;
    messageEl.innerText = "";
    restartBtn.style.display = 'none';
    matchedCount = 0;
    firstCard = null;

    // ê²Œì„ ì„¤ì •
    const diff = difficultySelect.value;
    const pairCount = diff === 'easy' ? 4 : diff === 'medium' ? 6 : diff === 'hard' ? 8 : 32; // ìµìŠ¤íŠ¸ë¦¼: 32ìŒ
    const showTime = diff === 'easy' ? 1000 : diff === 'medium' ? 2000 : diff === 'hard' ? 3000 : 5000; // ìµìŠ¤íŠ¸ë¦¼: 5ì´ˆ

    // ì¹´ë“œ ë°°ì—´ ì¤€ë¹„
    const chosen = emojiSets.slice(0, pairCount);
    const cards = shuffle([...chosen, ...chosen]);

    // ê·¸ë¦¬ë“œ ì»¬ëŸ¼ ì„¤ì • (ìµìŠ¤íŠ¸ë¦¼ì€ 8ì—´, ë‚˜ë¨¸ì§€ëŠ” ìµœëŒ€ 4ì—´)
    const cols = diff === 'extreme' ? 8 : Math.min(pairCount, 4);
    gameBoard.style.gridTemplateColumns = `repeat(${cols}, 60px)`;
    gameBoard.innerHTML = '';
    lock = true; // ë¯¸ë¦¬ë³´ê¸° ë™ì•ˆ í´ë¦­ ê¸ˆì§€

    // ì¹´ë“œ ìƒì„± ë° ì•ë©´(ë³´ì´ê²Œ) ìƒíƒœ
    cards.forEach(icon => {
      const el = document.createElement('div');
      el.className = 'card flipped';
      el.dataset.icon = icon;
      el.innerText = icon;
      el.addEventListener('click', () => flip(el, cards.length));
      gameBoard.appendChild(el);
    });

    // ë¯¸ë¦¬ë³´ê¸° í›„ ì¹´ë“œ ê°€ë¦¬ê¸°, ê·¸ ì´í›„ì— íƒ€ì´ë¨¸ ì‹œì‘
    setTimeout(() => {
      document.querySelectorAll('.card').forEach(c => c.classList.remove('flipped'));
      lock = false; // ì´ì œ í´ë¦­ í—ˆìš©
      // íƒ€ì´ë¨¸ ì‹œì‘ (ê°€ë ¤ì§„ ì´í›„ì— ì¸¡ì • ì‹œì‘)
      timerInterval = setInterval(() => {
        timer++;
        timerLabel.innerText = `ì‹œê°„: ${timer}ì´ˆ`;
      }, 1000);
    }, showTime);
  }

  function flip(cardEl, totalCards){
    if (lock || cardEl.classList.contains('flipped')) return;
    cardEl.classList.add('flipped');

    if (!firstCard){
      firstCard = cardEl;
      return;
    }

    // ë‘ë²ˆì§¸ ì¹´ë“œê°€ ì„ íƒëœ ìƒíƒœ
    if (firstCard.dataset.icon === cardEl.dataset.icon){
      // ì •ë‹µ
      matchedCount += 2;
      firstCard = null;
      // ëª¨ë‘ ë§ì·„ëŠ”ì§€ í™•ì¸
      if (matchedCount === totalCards){
        onClear();
      }
    } else {
      // ì˜¤ë‹µ
      lock = true; // ì ì‹œ í´ë¦­ ê¸ˆì§€
      setTimeout(() => {
        cardEl.classList.remove('flipped');
        firstCard.classList.remove('flipped');
        firstCard = null;
        lock = false;
      }, 800);
    }
  }

  function onClear(){
    // í´ë¦¬ì–´ ì²˜ë¦¬
    if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
    messageEl.innerText = 'ğŸ‰ í´ë¦¬ì–´! ì¶•í•˜í•©ë‹ˆë‹¤!';
    records.push(timer);
    records.sort((a,b)=>a-b);
    updateScoreboardDisplay();
    restartBtn.style.display = 'inline-block';
    lock = true; // ê²Œì„ ì¢…ë£Œ ìƒíƒœë¡œ í´ë¦­ ë§‰ìŒ
  }

  function giveUp(){
    // ì¤‘ë„í¬ê¸° ì²˜ë¦¬: íƒ€ì´ë¨¸ ì •ì§€, ë©”ì‹œì§€ í‘œì‹œ, ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ í‘œì‹œ
    if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
    lock = true;
    messageEl.innerText = 'ğŸ›‘ ì¤‘ë„ í¬ê¸°í–ˆìŠµë‹ˆë‹¤.';
    restartBtn.style.display = 'inline-block';
  }

  function updateScoreboardDisplay(){
    if (!scoreboardEl) return;
    if (records.length === 0){
      scoreboardEl.innerHTML = '<b>ê¸°ë¡</b><br>ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.';
    } else {
      // ê°€ì¥ ë¹ ë¥¸ ê¸°ë¡ì´ ìœ„ë¡œ ì˜¤ë„ë¡ ì •ë ¬(ì˜¤ë¦„ì°¨ìˆœ)
      scoreboardEl.innerHTML = '<b>ê¸°ë¡</b><br>' + records.map((r,i)=>`${i+1}. ${r}ì´ˆ`).join('<br>');
    }
  }

  function shuffle(array){
    // Fisher-Yates
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

});
</script>
</body>
</html>
